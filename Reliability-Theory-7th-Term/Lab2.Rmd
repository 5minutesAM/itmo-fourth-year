---
title: "Lab2"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
library(markovchain)
library(expm)

knitr::opts_chunk$set(echo = TRUE)
options(scipen=999, digits=6)
```

## Вариант 8

* Число параллельно соединенных одинаковых элементов: 5
* Интенсивность отказов: 0,0002
* Интенсивность восстановлений: 0,3
* Число отказов, после которого начинается восстановление: 1

После любого восстановления сразу запускается в работу, при этом отказы возможны.

## Задание

1. Построить граф марковской модели 
2. Составить алгебраические уравнения 
3. Определить стационарный  коэффициент готовности
4. Составить дифференциальные уравнения
5. Построить график зависимости нестационарного коэффициента готовности от времени

## Построение графа марковской модели

При построении графа следует стремиться к минимизации числа состояний. В рассматриваемом случае это возможно из-за симметричности системы,
т.е. наличия идентичных параллельно соединенных элементов. Выделим следующие состояния:

1. все элементы работоспособны;
2. один элемент отказал и восстанавливается (восстановление начинается после первого отказа);
3. два элемента отказали, происходит восстановление;
4. три элемента отказали, происходит восстановление;
5. четыре элемента отказали, происходит восстановление;
6. все элементы отказали, происходит восстановление.

Построим граф, обозначив интенсивность отказов как $\lambda$, а восстановлений — как $\mu$:

![Рисунок 1. Граф марковской модели](Lab2/Graph.png)

## Составление алгебраических уравнений и определение стационарного коэффициента готовности

Составим матрицу интенсивности переходов по графу: 

```{r}
lambda <- 0.0002
mu <- 0.3

states <- c("1", "2", "3", "4", "5", "6")
transition_rate_M <- matrix(
  data = c(
    0, 5*lambda, 0, 0, 0, 0,
    mu, 0, 4*lambda, 0, 0, 0,
    0, mu, 0, 3*lambda, 0, 0,
    0, 0, mu, 0, 2*lambda, 0,
    0, 0, 0, mu, 0, lambda,
    0, 0, 0, 0, mu, 0
  ),
  byrow = T, ncol = 6, dimnames = list(states, states))
diag(transition_rate_M) <- -rowSums(transition_rate_M)
transition_rate_M
```

Произведем расчет стационарных вероятностей:

```{r}
mc <- new("ctmc", states = states, byrow = T, generator = transition_rate_M)
steady_ps <- steadyStates(mc)
steady_ps
```

Видим, что наиболее вероятно первое состояние системы, что объясняется значительно большей интенсивностью восстановлений, чем отказов.

## Определение стационарного коэффициента готовности

Готовность системы определяется как сумма ее работоспособных состояний. Для определения стационарного коэффициента готовности просуммируем стационарные вероятности состояний $p_1$-$p_5$:

```{r}
sum(steady_ps[1:5])
```
$$K_r = p_1 + p_2 + p_3 + p_4 + p_5 = 1$$

## Составление дифференциальных уравнений

Составим для каждого состояния уравнения, руководствуясь следующими правилами:

* в левой части записывается производная по времени $t$;
* в правой части записывается сумма произведений:
    * интенсивности перехода из рассматриваемого состояния с отрицательным знаком на его вероятность,
    * интенсивности перехода в рассматриваемое состояние с положительным знаком на вероятность исходного состояния.

$$
\frac{d}{dt}P_1(t) = -5\lambda P_1(t) + \mu P_2(t),\\
\frac{d}{dt}P_2(t) = -(4\lambda + \mu) P_2(t) + \mu P_3(t),\\
\frac{d}{dt}P_3(t) = -(3\lambda + \mu) P_3(t) + \mu P_4(t),\\
\frac{d}{dt}P_4(t) = -(2\lambda + \mu) P_4(t) + \mu P_5(t),\\
\frac{d}{dt}P_5(t) = -(\lambda + \mu) P_5(t) + \mu P_6(t),\\
\frac{d}{dt}P_6(t) = -\mu P_6(t)
$$

## Построение графика зависимости нестационарного коэффициента готовности от времени

Нестационарный коэффициент готовности для рассматриваемой системы равен $K_r = p_1 + p_2 + p_3 + p_4 + p_5$.

Для решения дифферециальных уравнений найдем экспоненту матрицы интенсивностей переходов, умноженную на время $t$:

```{r}
initial_state <- 1
p <- function(t, i) expm(t*transition_rate_M)[initial_state, i]
k_r <- function(t) p(t, 1) + p(t, 2) + p(t, 3) + p(t, 4) + p(t, 5)
```

Построим график зависимости:

```{r, warning=F}
t <- seq(0, 100, 0.2)

par(mar = c(4, 9, 2, 2))
plot(t, sapply(t, k_r), type="l", axes = F, xlab="Время", ylab="Коэффициент готовности", ylim=c(0.99999999999998, 1.000000000000001))
axis(1, at=c(0, 100))
axis(2, at=c(0.99999999999998, 1.0000000000000), labels=c(0.99999999999998, 1.0000000000000), las = 2)
```

*Рисунок 2. График зависимости нестационарного коэффициента готовности от времени*

С течением времени коэффициент готовности снижается, но остается в пределах 1.

## Вывод

В ходе выполнения работы произведен расчет стационарного коэффициента готовности системы и
построена зависимость нестационарного коэффициента готовности от времени
путем представления системы как марковского процесса.
